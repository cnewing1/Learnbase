<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Math Masters - Multiplication Game</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
            overflow: hidden;
            touch-action: none;
        }

        /* Theme styles */
        body.space {
            background: linear-gradient(135deg, #0a0e27 0%, #1a1442 50%, #2d1b69 100%);
        }

        body.ocean {
            background: linear-gradient(135deg, #003d5c 0%, #0066a1 50%, #00a8e8 100%);
        }

        body.forest {
            background: linear-gradient(135deg, #1a4314 0%, #2d5a27 50%, #4a7c3f 100%);
        }

        .container {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .stars {
            position: absolute;
            width: 100%;
            height: 100%;
            overflow: hidden;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 3s infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        .screen {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 800px;
            width: 90%;
            z-index: 10;
            animation: slideIn 0.5s ease-out;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            color: #ff6b6b;
            text-align: center;
            font-size: 3em;
            margin-bottom: 20px;
            text-shadow: 3px 3px 6px rgba(0,0,0,0.2);
        }

        h2 {
            color: #4ecdc4;
            text-align: center;
            margin-bottom: 20px;
        }

        .login-screen input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 3px solid #4ecdc4;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.3em;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            transition: all 0.3s;
            font-weight: bold;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.4);
        }

        .btn:active {
            transform: translateY(0);
        }

        .table-grid {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .table-btn {
            padding: 20px;
            font-size: 1.5em;
            border-radius: 15px;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
        }

        .table-btn.completed {
            background: linear-gradient(135deg, #56ab2f 0%, #a8e063 100%);
            color: white;
        }

        .table-btn.current {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            animation: pulse 1.5s infinite;
        }

        .table-btn.locked {
            background: #cccccc;
            color: #666;
            cursor: not-allowed;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .lives {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
            font-size: 2em;
        }

        .heart {
            color: #ff6b6b;
            animation: heartbeat 1.5s infinite;
        }

        @keyframes heartbeat {
            0%, 100% { transform: scale(1); }
            10% { transform: scale(1.1); }
            20% { transform: scale(1); }
        }

        .question-area {
            text-align: center;
            margin: 40px 0;
        }

        .question {
            font-size: 3em;
            color: #2d3436;
            margin-bottom: 30px;
            font-weight: bold;
        }

        .answer-input {
            width: 200px;
            padding: 20px;
            font-size: 2em;
            text-align: center;
            border: 4px solid #4ecdc4;
            border-radius: 15px;
            margin: 0 20px;
        }

        .feedback {
            font-size: 1.5em;
            margin-top: 20px;
            min-height: 40px;
            font-weight: bold;
        }

        .correct {
            color: #00b894;
        }

        .incorrect {
            color: #d63031;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        /* Mini-game styles */
        .game-canvas {
            border: 4px solid #333;
            border-radius: 10px;
            background: #000;
            display: block;
            margin: 20px auto;
            touch-action: none;
        }

        .game-controls {
            text-align: center;
            margin: 20px 0;
        }

        .control-btn {
            background: #4ecdc4;
            color: white;
            border: none;
            padding: 15px 30px;
            margin: 5px;
            font-size: 1.2em;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
        }

        .control-btn:active {
            background: #3da09a;
        }

        .timer {
            font-size: 2em;
            color: #ff6b6b;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
        }

        .hidden {
            display: none;
        }

        .celebration {
            position: absolute;
            font-size: 3em;
            animation: celebrate 1s ease-out;
            z-index: 100;
        }

        @keyframes celebrate {
            0% {
                opacity: 1;
                transform: translateY(0) scale(0.5);
            }
            100% {
                opacity: 0;
                transform: translateY(-200px) scale(2);
            }
        }

        .user-info {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2em;
            color: #2d3436;
            z-index: 20;
        }

        .theme-indicator {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255,255,255,0.9);
            padding: 15px 25px;
            border-radius: 15px;
            font-weight: bold;
            font-size: 1.2em;
            z-index: 20;
        }

        .poker-cards {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 20px 0;
        }

        .card {
            width: 80px;
            height: 120px;
            background: white;
            border: 3px solid #333;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card:hover {
            transform: translateY(-10px);
        }

        .card.selected {
            border-color: #4ecdc4;
            background: #e8f8f7;
        }

        .card.red {
            color: #d63031;
        }

        .card.black {
            color: #2d3436;
        }

        .poker-result {
            font-size: 1.8em;
            margin: 20px 0;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body class="space">
    <div class="stars" id="stars"></div>
    <div class="container">
        <div class="theme-indicator" id="themeIndicator"></div>


        <!-- Table Selection Screen -->
        <div class="screen hidden" id="tableScreen">
            <h1>Choose Your Table</h1>
            <div id="playerProgress"></div>
            <div class="table-grid" id="tableGrid"></div>
            <div style="text-align: center; margin-top: 20px;">
                
            </div>
        </div>

        <!-- Quiz Screen -->
        <div class="screen hidden" id="quizScreen">
            <h2 id="tableTitle"></h2>
            <div class="lives" id="lives"></div>
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill">0/10</div>
            </div>
            <div class="question-area">
                <div class="question" id="question"></div>
                <input type="number" class="answer-input" id="answerInput" autocomplete="off">
                <div class="feedback" id="feedback"></div>
            </div>
            <div style="text-align: center;">
                <button class="btn" onclick="submitAnswer()">Submit Answer</button>
                <button class="btn" onclick="backToTables()" style="background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%); margin-left: 20px;">Exit</button>
            </div>
        </div>

        <!-- Mini-Game Screen -->
        <div class="screen hidden" id="miniGameScreen" style="max-width: 1000px;">
            <h1 id="miniGameTitle"></h1>
            <div class="timer" id="gameTimer"></div>
            <canvas id="gameCanvas" class="game-canvas" width="800" height="600"></canvas>
            <div class="game-controls" id="gameControls"></div>
            <div style="text-align: center; margin-top: 20px;">
                <button class="btn" onclick="finishMiniGame()">Finish & Continue</button>
            </div>
        </div>
    </div>

    <script>
        // Game State
        
        let currentTable = 1;
        let lives = 3;
        let currentQuestion = 0;
        let totalQuestions = 10;
        let num1, num2, correctAnswer;
        let gameData = {};
        let currentTheme = 'space';
        let miniGameTimer;
        let miniGameTimeLeft;

        // Themes
        const themes = ['space', 'ocean', 'forest'];
        const themeNames = {
            space: 'üöÄ Space Theme',
            ocean: 'üåä Ocean Theme',
            forest: 'üå≤ Forest Theme'
        };

        // Initialize
            function init() {
    selectRandomTheme();
    createStars();
    renderTableGrid();
    showScreen('tableScreen');

    document.getElementById('answerInput').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') submitAnswer();
    });
}
        
            // Enter key support
            
            });
            document.getElementById('answerInput').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') submitAnswer();
            });
        }

        function selectRandomTheme() {
            currentTheme = themes[Math.floor(Math.random() * themes.length)];
            document.body.className = currentTheme;
            document.getElementById('themeIndicator').textContent = themeNames[currentTheme];
        }

        function createStars() {
            const starsContainer = document.getElementById('stars');
            starsContainer.innerHTML = '';
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 3 + 's';
                starsContainer.appendChild(star);
            }
        }

    
            currentUser = username;
            if (!gameData[currentUser]) {
                gameData[currentUser] = {
                    completedTables: [],
                    currentTable: 1
                };
            }
            
            showScreen('tableScreen');
            renderTableGrid();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            document.getElementById(screenId).classList.remove('hidden');
        }

        function renderTableGrid() {
    const grid = document.getElementById('tableGrid');
    grid.innerHTML = '';

    for (let i = 1; i <= 12; i++) {
        const btn = document.createElement('button');
        btn.className = 'table-btn';
        btn.textContent = `${i} √ó`;
        btn.onclick = () => startQuiz(i);
        grid.appendChild(btn);
    }

    document.getElementById('playerProgress').innerHTML =
        `<h2>Select Any Table to Practice üéØ</h2>`;
}

        function startQuiz(table) {
            const userData = gameData[currentUser];
            if (table > userData.currentTable) return;
            
            currentTable = table;
            currentQuestion = 0;
            lives = 3;
            
            document.getElementById('tableTitle').textContent = `${table} Times Table Challenge`;
            updateLives();
            showScreen('quizScreen');
            nextQuestion();
        }

        function updateLives() {
            const livesDiv = document.getElementById('lives');
            livesDiv.innerHTML = '';
            for (let i = 0; i < lives; i++) {
                const heart = document.createElement('span');
                heart.className = 'heart';
                heart.textContent = '‚ù§Ô∏è';
                livesDiv.appendChild(heart);
            }
        }

        function nextQuestion() {
            if (currentQuestion >= totalQuestions) {
                completeTable();
                return;
            }
            
            num1 = currentTable;
            num2 = Math.floor(Math.random() * 10) + 1;
            correctAnswer = num1 * num2;
            
            document.getElementById('question').textContent = `${num1} √ó ${num2} = ?`;
            document.getElementById('answerInput').value = '';
            document.getElementById('answerInput').focus();
            document.getElementById('feedback').textContent = '';
            
            updateProgress();
        }

        function updateProgress() {
            const percentage = (currentQuestion / totalQuestions) * 100;
            const fill = document.getElementById('progressFill');
            fill.style.width = percentage + '%';
            fill.textContent = `${currentQuestion}/${totalQuestions}`;
        }

        function submitAnswer() {
            const userAnswer = parseInt(document.getElementById('answerInput').value);
            const feedback = document.getElementById('feedback');
            
            if (isNaN(userAnswer)) {
                feedback.textContent = 'Please enter a number!';
                feedback.className = 'feedback incorrect';
                return;
            }
            
            if (userAnswer === correctAnswer) {
                feedback.textContent = 'üéâ Correct! Great job!';
                feedback.className = 'feedback correct';
                createCelebration();
                currentQuestion++;
                setTimeout(nextQuestion, 1500);
            } else {
                lives--;
                updateLives();
                feedback.textContent = `‚ùå Not quite! The answer is ${correctAnswer}`;
                feedback.className = 'feedback incorrect';
                
                if (lives <= 0) {
                    setTimeout(() => {
                        alert('Game Over! Try again!');
                        backToTables();
                    }, 2000);
                } else {
                    currentQuestion++;
                    setTimeout(nextQuestion, 2500);
                }
            }
        }

        function createCelebration() {
            const emojis = ['üåü', '‚≠ê', '‚ú®', 'üéä', 'üéâ', 'üí´'];
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const celebration = document.createElement('div');
                    celebration.className = 'celebration';
                    celebration.textContent = emojis[Math.floor(Math.random() * emojis.length)];
                    celebration.style.left = Math.random() * 80 + 10 + '%';
                    celebration.style.top = '50%';
                    document.body.appendChild(celebration);
                    setTimeout(() => celebration.remove(), 1000);
                }, i * 100);
            }
        }

       function completeTable() {
    alert(`üéä Great job! You completed the ${currentTable} times table! 
Get ready for a mini-game reward!`);
    startMiniGame();
}     
            alert(`üéä Congratulations! You completed the ${currentTable} times table! 
Get ready for a mini-game reward!`);
            startMiniGame();
        }

        function backToTables() {
            showScreen('tableScreen');
            renderTableGrid();
        }

        // Mini Games
        function startMiniGame() {
            const games = ['pinball', 'poker', 'racing'];
            const randomGame = games[Math.floor(Math.random() * games.length)];
            
            miniGameTimeLeft = 180; // 3 minutes
            
            showScreen('miniGameScreen');
            
            if (randomGame === 'pinball') {
                startPinball();
            } else if (randomGame === 'poker') {
                startPoker();
            } else {
                startRacing();
            }
            
            startMiniGameTimer();
        }

        function startMiniGameTimer() {
            const timerDiv = document.getElementById('gameTimer');
            miniGameTimer = setInterval(() => {
                miniGameTimeLeft--;
                const minutes = Math.floor(miniGameTimeLeft / 60);
                const seconds = miniGameTimeLeft % 60;
                timerDiv.textContent = `Time: ${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (miniGameTimeLeft <= 0) {
                    clearInterval(miniGameTimer);
                    finishMiniGame();
                }
            }, 1000);
        }

        function finishMiniGame() {
            clearInterval(miniGameTimer);
            backToTables();
        }

        // PINBALL GAME
        function startPinball() {
            document.getElementById('miniGameTitle').textContent = 'üéØ Pinball Master';
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const controls = document.getElementById('gameControls');
            controls.innerHTML = '<div style="font-size: 1.2em;">Tap the screen to launch ball! Tilt device to control!</div>';
            
            let score = 0;
            let balls = 3;
            let ball = null;
            let bumpers = [];
            let flippers = {
                left: { x: 200, y: 550, angle: -0.3, pressed: false },
                right: { x: 600, y: 550, angle: 0.3, pressed: false }
            };
            
            // Create bumpers
            for (let i = 0; i < 8; i++) {
                bumpers.push({
                    x: 150 + (i % 4) * 150,
                    y: 150 + Math.floor(i / 4) * 150,
                    radius: 30,
                    color: `hsl(${i * 45}, 70%, 50%)`
                });
            }
            
            function launchBall() {
                if (ball || balls <= 0) return;
                ball = {
                    x: 750,
                    y: 500,
                    vx: -8,
                    vy: -15,
                    radius: 10
                };
            }
            
            canvas.addEventListener('click', launchBall);
            canvas.addEventListener('touchstart', (e) => {
                e.preventDefault();
                launchBall();
            });
            
            // Flipper controls
            const leftBtn = document.createElement('button');
            leftBtn.textContent = 'Left Flipper';
            leftBtn.className = 'control-btn';
            leftBtn.addEventListener('touchstart', () => flippers.left.pressed = true);
            leftBtn.addEventListener('touchend', () => flippers.left.pressed = false);
            leftBtn.addEventListener('mousedown', () => flippers.left.pressed = true);
            leftBtn.addEventListener('mouseup', () => flippers.left.pressed = false);
            
            const rightBtn = document.createElement('button');
            rightBtn.textContent = 'Right Flipper';
            rightBtn.className = 'control-btn';
            rightBtn.addEventListener('touchstart', () => flippers.right.pressed = true);
            rightBtn.addEventListener('touchend', () => flippers.right.pressed = false);
            rightBtn.addEventListener('mousedown', () => flippers.right.pressed = true);
            rightBtn.addEventListener('mouseup', () => flippers.right.pressed = false);
            
            controls.appendChild(leftBtn);
            controls.appendChild(rightBtn);
            
            function gameLoop() {
                ctx.fillStyle = '#1a1a2e';
                ctx.fillRect(0, 0, 800, 600);
                
                // Draw bumpers
                bumpers.forEach(bumper => {
                    ctx.fillStyle = bumper.color;
                    ctx.beginPath();
                    ctx.arc(bumper.x, bumper.y, bumper.radius, 0, Math.PI * 2);
                    ctx.fill();
                    ctx.strokeStyle = '#fff';
                    ctx.lineWidth = 3;
                    ctx.stroke();
                });
                
                // Draw flippers
                ctx.fillStyle = '#ff6b6b';
                ctx.save();
                ctx.translate(flippers.left.x, flippers.left.y);
                ctx.rotate(flippers.left.pressed ? -0.6 : -0.3);
                ctx.fillRect(-60, -10, 120, 20);
                ctx.restore();
                
                ctx.save();
                ctx.translate(flippers.right.x, flippers.right.y);
                ctx.rotate(flippers.right.pressed ? 0.6 : 0.3);
                ctx.fillRect(-60, -10, 120, 20);
                ctx.restore();
                
                // Update and draw ball
                if (ball) {
                    ball.vy += 0.4; // Gravity
                    ball.x += ball.vx;
                    ball.y += ball.vy;
                    
                    // Wall collisions
                    if (ball.x < ball.radius || ball.x > 800 - ball.radius) {
                        ball.vx *= -0.8;
                        ball.x = Math.max(ball.radius, Math.min(800 - ball.radius, ball.x));
                    }
                    if (ball.y < ball.radius) {
                        ball.vy *= -0.8;
                        ball.y = ball.radius;
                    }
                    
                    // Bottom - lose ball
                    if (ball.y > 600) {
                        ball = null;
                        balls--;
                        if (balls > 0) {
                            setTimeout(launchBall, 1000);
                        }
                    }
                    
                    // Bumper collisions
                    bumpers.forEach(bumper => {
                        const dx = ball.x - bumper.x;
                        const dy = ball.y - bumper.y;
                        const dist = Math.sqrt(dx * dx + dy * dy);
                        if (dist < ball.radius + bumper.radius) {
                            score += 100;
                            const angle = Math.atan2(dy, dx);
                            ball.vx = Math.cos(angle) * 12;
                            ball.vy = Math.sin(angle) * 12;
                        }
                    });
                    
                    // Draw ball
                    ctx.fillStyle = '#ffd700';
                    ctx.beginPath();
                    ctx.arc(ball.x, ball.y, ball.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
                
                // Draw score
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 24px Arial';
                ctx.fillText(`Score: ${score}`, 20, 40);
                ctx.fillText(`Balls: ${balls}`, 20, 70);
                
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
        }

        // POKER GAME
        function startPoker() {
            document.getElementById('miniGameTitle').textContent = 'üÉè Texas Hold\'em Poker';
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const controls = document.getElementById('gameControls');
            
            let chips = 1000;
            let bet = 0;
            let pot = 0;
            let playerHand = [];
            let dealerHand = [];
            let communityCards = [];
            let deck = [];
            let gamePhase = 'start'; // start, flop, turn, river, showdown
            
            const suits = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
            const ranks = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];
            
            function createDeck() {
                deck = [];
                for (let suit of suits) {
                    for (let rank of ranks) {
                        deck.push({ rank, suit, color: (suit === '‚ô•' || suit === '‚ô¶') ? 'red' : 'black' });
                    }
                }
                // Shuffle
                for (let i = deck.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [deck[i], deck[j]] = [deck[j], deck[i]];
                }
            }
            
            function dealCards() {
                createDeck();
                playerHand = [deck.pop(), deck.pop()];
                dealerHand = [deck.pop(), deck.pop()];
                communityCards = [];
                gamePhase = 'preflop';
                bet = 50;
                chips -= bet;
                pot = bet + 50; // Dealer matches
                drawGame();
            }
            
            function drawCard(card, x, y, faceDown = false) {
                ctx.fillStyle = '#fff';
                ctx.fillRect(x, y, 70, 100);
                ctx.strokeStyle = '#333';
                ctx.lineWidth = 2;
                ctx.strokeRect(x, y, 70, 100);
                
                if (!faceDown) {
                    ctx.fillStyle = card.color === 'red' ? '#d63031' : '#2d3436';
                    ctx.font = 'bold 20px Arial';
                    ctx.fillText(card.rank, x + 10, y + 30);
                    ctx.font = 'bold 24px Arial';
                    ctx.fillText(card.suit, x + 10, y + 60);
                }
            }
            
            function drawGame() {
                ctx.fillStyle = '#0d7377';
                ctx.fillRect(0, 0, 800, 600);
                
                // Draw dealer hand
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 20px Arial';
                ctx.fillText('Dealer:', 20, 30);
                dealerHand.forEach((card, i) => {
                    drawCard(card, 20 + i * 80, 40, gamePhase !== 'showdown');
                });
                
                // Draw community cards
                if (communityCards.length > 0) {
                    ctx.fillText('Community Cards:', 250, 250);
                    communityCards.forEach((card, i) => {
                        drawCard(card, 250 + i * 80, 260);
                    });
                }
                
                // Draw player hand
                ctx.fillText('Your Hand:', 20, 450);
                playerHand.forEach((card, i) => {
                    drawCard(card, 20 + i * 80, 460);
                });
                
                // Draw stats
                ctx.fillText(`Chips: $${chips}`, 600, 50);
                ctx.fillText(`Pot: $${pot}`, 600, 80);
                ctx.fillText(`Current Bet: $${bet}`, 600, 110);
            }
            
            function nextPhase() {
                if (gamePhase === 'preflop') {
                    communityCards.push(deck.pop(), deck.pop(), deck.pop());
                    gamePhase = 'flop';
                } else if (gamePhase === 'flop') {
                    communityCards.push(deck.pop());
                    gamePhase = 'turn';
                } else if (gamePhase === 'turn') {
                    communityCards.push(deck.pop());
                    gamePhase = 'river';
                } else if (gamePhase === 'river') {
                    gamePhase = 'showdown';
                    showdown();
                }
                drawGame();
            }
            
            function showdown() {
                // Simple hand evaluation (high card for demo)
                const playerHigh = Math.max(...playerHand.map(c => ranks.indexOf(c.rank)));
                const dealerHigh = Math.max(...dealerHand.map(c => ranks.indexOf(c.rank)));
                
                setTimeout(() => {
                    if (playerHigh > dealerHigh) {
                        chips += pot;
                        alert(`You Win! +$${pot}`);
                    } else if (playerHigh < dealerHigh) {
                        alert('Dealer Wins!');
                    } else {
                        chips += pot / 2;
                        alert('Tie! You get half the pot back.');
                    }
                    pot = 0;
                    bet = 0;
                    drawGame();
                }, 1000);
            }
            
            controls.innerHTML = '';
            const dealBtn = document.createElement('button');
            dealBtn.textContent = 'New Hand ($50)';
            dealBtn.className = 'control-btn';
            dealBtn.onclick = dealCards;
            
            const callBtn = document.createElement('button');
            callBtn.textContent = 'Call/Check';
            callBtn.className = 'control-btn';
            callBtn.onclick = nextPhase;
            
            const raiseBtn = document.createElement('button');
            raiseBtn.textContent = 'Raise $50';
            raiseBtn.className = 'control-btn';
            raiseBtn.onclick = () => {
                if (chips >= 50) {
                    chips -= 50;
                    bet += 50;
                    pot += 100;
                    drawGame();
                }
            };
            
            controls.appendChild(dealBtn);
            controls.appendChild(callBtn);
            controls.appendChild(raiseBtn);
            
            drawGame();
            dealCards();
        }

        // RACING GAME
        function startRacing() {
            document.getElementById('miniGameTitle').textContent = 'üèçÔ∏è Moto Racing';
            const canvas = document.getElementById('gameCanvas');
            const ctx = canvas.getContext('2d');
            const controls = document.getElementById('gameControls');
            
            let playerY = 300;
            let playerSpeed = 0;
            let score = 0;
            let obstacles = [];
            let roadOffset = 0;
            
            let upPressed = false;
            let downPressed = false;
            
            controls.innerHTML = '';
            const upBtn = document.createElement('button');
            upBtn.textContent = '‚¨ÜÔ∏è Up';
            upBtn.className = 'control-btn';
            upBtn.addEventListener('touchstart', () => upPressed = true);
            upBtn.addEventListener('touchend', () => upPressed = false);
            upBtn.addEventListener('mousedown', () => upPressed = true);
            upBtn.addEventListener('mouseup', () => upPressed = false);
            
            const downBtn = document.createElement('button');
            downBtn.textContent = '‚¨áÔ∏è Down';
            downBtn.className = 'control-btn';
            downBtn.addEventListener('touchstart', () => downPressed = true);
            downBtn.addEventListener('touchend', () => downPressed = false);
            downBtn.addEventListener('mousedown', () => downPressed = true);
            downBtn.addEventListener('mouseup', () => downPressed = false);
            
            controls.appendChild(upBtn);
            controls.appendChild(downBtn);
            
            function spawnObstacle() {
                if (Math.random() < 0.02) {
                    obstacles.push({
                        x: 800,
                        y: Math.random() * 500 + 50,
                        width: 60,
                        height: 60,
                        speed: 8 + Math.random() * 4
                    });
                }
            }
            
            function gameLoop() {
                // Update
                if (upPressed && playerY > 50) playerSpeed = -5;
                else if (downPressed && playerY < 550) playerSpeed = 5;
                else playerSpeed *= 0.9;
                
                playerY += playerSpeed;
                playerY = Math.max(50, Math.min(550, playerY));
                
                roadOffset += 8;
                if (roadOffset > 100) roadOffset = 0;
                
                spawnObstacle();
                
                obstacles.forEach(obs => {
                    obs.x -= obs.speed;
                });
                
                obstacles = obstacles.filter(obs => {
                    if (obs.x < -100) {
                        score += 10;
                        return false;
                    }
                    
                    // Collision detection
                    if (obs.x < 150 && obs.x > 50 && 
                        Math.abs(obs.y - playerY) < 50) {
                        score = Math.max(0, score - 50);
                    }
                    
                    return obs.x > -100;
                });
                
                // Draw
                ctx.fillStyle = '#2d3436';
                ctx.fillRect(0, 0, 800, 600);
                
                // Draw road
                ctx.fillStyle = '#636e72';
                ctx.fillRect(0, 0, 800, 600);
                
                // Road lines
                ctx.strokeStyle = '#f1c40f';
                ctx.lineWidth = 5;
                for (let i = -1; i < 10; i++) {
                    ctx.beginPath();
                    ctx.moveTo(i * 100 + roadOffset, 0);
                    ctx.lineTo(i * 100 + roadOffset, 600);
                    ctx.stroke();
                }
                
                // Draw player bike
                ctx.fillStyle = '#00b894';
                ctx.fillRect(80, playerY - 25, 60, 50);
                ctx.fillStyle = '#2d3436';
                ctx.fillRect(90, playerY - 15, 20, 30);
                ctx.fillRect(110, playerY - 15, 20, 30);
                
                // Draw obstacles (cars)
                obstacles.forEach(obs => {
                    ctx.fillStyle = '#d63031';
                    ctx.fillRect(obs.x, obs.y - 30, obs.width, obs.height);
                    ctx.fillStyle = '#2d3436';
                    ctx.fillRect(obs.x + 10, obs.y - 20, 15, 15);
                    ctx.fillRect(obs.x + 35, obs.y - 20, 15, 15);
                });
                
                // Draw score
                ctx.fillStyle = '#fff';
                ctx.font = 'bold 28px Arial';
                ctx.fillText(`Distance: ${score}m`, 20, 40);
                
                requestAnimationFrame(gameLoop);
            }
            
            gameLoop();
        }

        // Initialize on load
        window.onload = init;
    </script>
</body>
</html>
